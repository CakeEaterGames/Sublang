
//Equivalent to out = addr[offset]
function geti(addr, offset, out){
	set(geti+5, cb)
	set(geti+6, addr)
	set(geti+7, offset)

	jump(geti)
	cb: comeback,
	comeback:
	set(out,_return1)
}

function _geti()
{
	jump(skipVars)
		ret: jump(0),
		addr: 0,
		offset: 0,
		temp: 0,
	skipVars:
 
	clear(getpart)
	clear(temp)
	sub(temp, addr)
	sub(temp, offset)
	sub(getpart, temp)

	clear(_return1)
	clear(temp)

	getpart:
	sub(temp, 0)
	sub(_return1, temp)
 

	jump(ret)
}

//Equivalent to addr[offset] = val
function seti(addr, offset, val){
	set(seti+5, cb)
	set(seti+6, addr)
	set(seti+7, offset)
	set(seti+8, val)

	jump(seti)
	cb: comeback,
	comeback:
 
}

function _seti()
{
	jump(skipVars)
		ret: jump(0),
		addr: 0,
		offset: 0,
		val: 0,
		temp: 0,
	skipVars:

	clear(temp)
	sub(temp, addr)
	sub(temp, offset)
		
	clear(clearpart)
	sub(clearpart,temp)

	clear(clearpart+1)
	sub(clearpart+1,temp)

	clear(setpart+1)
	sub(setpart+1, temp)
	 
	clear(temp)
	sub(temp,val)

	clearpart:
	sub(0, 0)
	setpart:
	sub(0, temp)


	jump(ret)
}




//Access the main memory of the program
//Equivalent to _return1 = code[ptr]

function memGet(ptr,out){
	set(memGet+5, cb)
	set(memGet+6, ptr)

	jump(memGet)
	cb: comeback,
	comeback:
	set(out,_return1)
}

function _memGet()
{
	jump(skipVars)
		ret: jump(0),
		ptr: 0,
		t: 0,
	skipVars:

	clear(t)
	set(here,ptr)

	here:
	subleq(0,t)
	clear(_return1)
	sub(_return1,t)

	jump(ret)
}

//Access the main memory of the program
//Equivalent to code[ptr] = val

function memSet(ptr,val){
	set(memSet+5, cb)
	set(memSet+6, ptr)
	set(memSet+7, val)

	jump(memSet)
	cb: comeback,
	comeback:
}

function _memSet()
{
	jump(skipVars)
		ret: jump(0),
		ptr: 0,
		a: 0,
		t: 0,
	skipVars:

	set(clr,ptr)
	set(clr+1,ptr)
	set(here+1,ptr)

	clr:
	subleq(0,0)
	
	clear(t)
	sub(t,a)

	here:
	subleq(t,0)

	jump(ret)
}



function push(stack,val)
{
	inc(stack)
	seti(stack,zero,val)
}
function pop(stack,val)
{
	geti(stack,zero,val)
	dec(stack)
}
function push(val)
{
	push(_stack,val)
}
function pop(val)
{
	pop(_stack,val)
}


function copyArea(start,len,dest)
{
	set(copyArea+5, cb)
	set(copyArea+6, start)
	set(copyArea+7, len)
	set(copyArea+8, dest)

	jump(copyArea)
	cb: comeback,
	comeback:
}

function _copyArea()
{
	jump(skipVars)
		ret: jump(0),
		start: 0,
		len: 0,
		dest: 0,
		temp: 0,
		i:0,
	skipVars:
	
	set(getPart,start)
	set(clearPart,dest)
	set(clearPart+1,dest)
	set(setPart+1,dest)
	
	clear(i)
	sub(i,len)
	inc(i)

	loop:
		clear(temp)

		getPart:
		sub(temp,0)
	
		clearPart:
		clear(0)
	
		setPart:
		sub(0,temp)
	
		inc(getPart)
		inc(clearPart)
		inc(clearPart+1)
		inc(setPart+1)
	incJump(i,loop)

	jump(ret)
}


function clearArea(start,len)
{
	set(clearArea+5, cb)
	set(clearArea+6, start)
	set(clearArea+7, len)

	jump(clearArea)
	cb: comeback,
	comeback:
}

function _clearArea()
{
	jump(skipVars)
		ret: jump(0),
		start: 0,
		len: 0,
		i:0,
	skipVars:
	
	set(clearPart,start)
	set(clearPart+1,start)
	
	clear(i)
	sub(i,len)
	inc(i)

	loop:	
		clearPart:
		clear(0)
 
		inc(clearPart)
		inc(clearPart+1)
	incJump(i,loop)

	jump(ret)
}